{{ define "slack.default.title" }}
{{- if eq .Status "firing" -}}
ğŸš¨ [{{ .CommonLabels.severity | upper }}] {{ .CommonLabels.alertname }}
{{- else -}}
âœ… [RESOLVED] {{ .CommonLabels.alertname }}
{{- end -}}
{{ end }}

{{ define "slack.default.text" }}
{{ range .Alerts }}
{{- if eq .Status "firing" }}
*Alert:* {{ .Annotations.summary }}
*Description:* {{ .Annotations.description }}
*Service:* {{ .Labels.service }}
*Severity:* {{ .Labels.severity }}
*Category:* {{ .Labels.category | default "general" }}
*Team:* {{ .Labels.team | default "engineering" }}
*Started:* {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}
{{- if .Annotations.runbook_url }}
*Runbook:* {{ .Annotations.runbook_url }}
{{- end }}
{{- if .Annotations.impact }}
*Impact:* {{ .Annotations.impact }}
{{- end }}
{{- else }}
*Resolved:* {{ .Annotations.summary }}
*Duration:* {{ .StartsAt.Format "15:04" }} - {{ .EndsAt.Format "15:04" }} ({{ .EndsAt.Sub .StartsAt | humanize }})
{{- end }}
{{ end }}
{{ end }}

{{ define "slack.critical.title" }}
ğŸš¨ğŸš¨ [CRITICAL] {{ .CommonLabels.alertname }} - IMMEDIATE ACTION REQUIRED
{{ end }}

{{ define "slack.critical.text" }}
{{ range .Alerts }}
âš ï¸ *CRITICAL ALERT - IMMEDIATE ATTENTION REQUIRED* âš ï¸

*Alert:* {{ .Annotations.summary }}
*Description:* {{ .Annotations.description }}
*Service:* {{ .Labels.service }}
*Instance:* {{ .Labels.instance | default "N/A" }}
*Started:* {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}

{{- if .Annotations.impact }}
ğŸ”¥ *Business Impact:* {{ .Annotations.impact }}
{{- end }}

{{- if .Annotations.runbook_url }}
ğŸ“– *Immediate Action Guide:* {{ .Annotations.runbook_url }}
{{- end }}

*Next Steps:*
1. Acknowledge this alert immediately
2. Follow the runbook procedures
3. Update #incidents channel with status
4. Page on-call engineer if needed

*Escalation:* If not resolved in 15 minutes, auto-escalate to senior engineer
{{ end }}
{{ end }}

{{ define "slack.warning.title" }}
âš ï¸ [WARNING] {{ .CommonLabels.alertname }}
{{ end }}

{{ define "slack.warning.text" }}
{{ range .Alerts }}
*Alert:* {{ .Annotations.summary }}
*Description:* {{ .Annotations.description }}
*Service:* {{ .Labels.service }}
*Severity:* {{ .Labels.severity }}
*Started:* {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}

{{- if .Annotations.impact }}
*Impact:* {{ .Annotations.impact }}
{{- end }}

{{- if .Annotations.runbook_url }}
*Runbook:* {{ .Annotations.runbook_url }}
{{- end }}

*Action Required:* Monitor and investigate within 30 minutes
{{ end }}
{{ end }}

{{ define "slack.business.title" }}
ğŸ“Š [BUSINESS] {{ .CommonLabels.alertname }}
{{ end }}

{{ define "slack.business.text" }}
{{ range .Alerts }}
ğŸ“ˆ *Business Metric Alert*

*Metric:* {{ .Annotations.summary }}
*Details:* {{ .Annotations.description }}
*Service:* {{ .Labels.service }}
*Category:* {{ .Labels.category }}
*Team:* {{ .Labels.team }}
*Started:* {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}

{{- if .Annotations.impact }}
ğŸ’° *Business Impact:* {{ .Annotations.impact }}
{{- end }}

{{- if .Annotations.runbook_url }}
ğŸ“‹ *Analysis Guide:* {{ .Annotations.runbook_url }}
{{- end }}

*Recommended Actions:*
â€¢ Review business metrics dashboard
â€¢ Analyze user behavior patterns
â€¢ Check for external factors (marketing campaigns, etc.)
â€¢ Consider A/B test impact
{{ end }}
{{ end }}

{{ define "slack.mobile.title" }}
ğŸ“± [MOBILE] {{ .CommonLabels.alertname }}
{{ end }}

{{ define "slack.mobile.text" }}
{{ range .Alerts }}
ğŸ“± *Mobile App Alert*

*Issue:* {{ .Annotations.summary }}
*Details:* {{ .Annotations.description }}
*Platform:* {{ .Labels.platform | default "iOS/Android" }}
*App Version:* {{ .Labels.app_version | default "Multiple" }}
*Started:* {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}

{{- if .Annotations.impact }}
ğŸ“‰ *User Impact:* {{ .Annotations.impact }}
{{- end }}

{{- if .Annotations.runbook_url }}
ğŸ”§ *Troubleshooting Guide:* {{ .Annotations.runbook_url }}
{{- end }}

*Mobile Team Actions:*
â€¢ Check crash reporting tools (Crashlytics, Sentry)
â€¢ Review recent app releases
â€¢ Monitor app store reviews
â€¢ Check device/OS compatibility matrix
{{ end }}
{{ end }}

{{ define "slack.security.title" }}
ğŸ”’ [SECURITY] {{ .CommonLabels.alertname }} - SECURITY INCIDENT
{{ end }}

{{ define "slack.security.text" }}
{{ range .Alerts }}
ğŸ”’ *SECURITY ALERT - IMMEDIATE INVESTIGATION REQUIRED*

*Security Event:* {{ .Annotations.summary }}
*Details:* {{ .Annotations.description }}
*Source:* {{ .Labels.source_ip | default "Unknown" }}
*Service:* {{ .Labels.service }}
*Started:* {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}

{{- if .Annotations.impact }}
ğŸš¨ *Security Impact:* {{ .Annotations.impact }}
{{- end }}

{{- if .Annotations.runbook_url }}
ğŸ›¡ï¸ *Security Response Guide:* {{ .Annotations.runbook_url }}
{{- end }}

*IMMEDIATE ACTIONS REQUIRED:*
1. ğŸ” Investigate the source and scope
2. ğŸš« Block malicious IPs if confirmed
3. ğŸ“ Document all findings
4. ğŸ“ Notify security team lead
5. ğŸ” Review access logs and permissions

*Escalation:* Auto-escalate to CISO if not acknowledged in 10 minutes
{{ end }}
{{ end }}

{{ define "slack.sla.title" }}
ğŸ“Š [SLA VIOLATION] {{ .CommonLabels.alertname }}
{{ end }}

{{ define "slack.sla.text" }}
{{ range .Alerts }}
ğŸ“Š *SLA VIOLATION DETECTED*

*SLA Breach:* {{ .Annotations.summary }}
*Details:* {{ .Annotations.description }}
*Service:* {{ .Labels.service }}
*SLA Tier:* {{ .Labels.sla_tier | default "Standard" }}
*Started:* {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}

{{- if .Annotations.impact }}
ğŸ’¼ *Business Impact:* {{ .Annotations.impact }}
{{- end }}

{{- if .Annotations.runbook_url }}
ğŸ“‹ *SLA Response Procedures:* {{ .Annotations.runbook_url }}
{{- end }}

*SLA VIOLATION RESPONSE:*
â€¢ ğŸ“ Document incident start time
â€¢ ğŸ¯ Focus on rapid resolution
â€¢ ğŸ“¢ Communicate with affected customers
â€¢ ğŸ“Š Calculate potential customer credits
â€¢ ğŸ“ˆ Schedule post-incident review

*Customer Impact:* This may require customer notifications and service credits
{{ end }}
{{ end }}

{{ define "slack.resolved.title" }}
âœ… [RESOLVED] {{ .CommonLabels.alertname }}
{{ end }}

{{ define "slack.resolved.text" }}
{{ range .Alerts }}
âœ… *Alert Resolved*

*Issue:* {{ .Annotations.summary }}
*Service:* {{ .Labels.service }}
*Severity:* {{ .Labels.severity }}
*Duration:* {{ .StartsAt.Format "15:04" }} - {{ .EndsAt.Format "15:04" }} ({{ .EndsAt.Sub .StartsAt | humanize }})

{{- if eq .Labels.severity "critical" }}
ğŸ‰ *Critical issue resolved!* Services should be back to normal.
{{- else }}
âœ… *Issue resolved.* No further action required.
{{- end }}

*Follow-up Actions:*
â€¢ Verify all services are functioning normally
â€¢ Update any open incident tickets
â€¢ Consider if post-mortem is needed
{{ end }}
{{ end }}

{{ define "slack.color" }}
{{- if eq .Status "firing" -}}
  {{- if eq .CommonLabels.severity "critical" -}}
    danger
  {{- else if eq .CommonLabels.severity "warning" -}}
    warning
  {{- else -}}
    #439FE0
  {{- end -}}
{{- else -}}
  good
{{- end -}}
{{ end }}